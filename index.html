<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sugar Smooth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            touch-action: none; /* Disable default touch actions like pinch-zoom */
        }
        #gameCanvas {
            cursor: none;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .floating-text {
            animation: floatUp 1s ease-out forwards;
            position: absolute;
            font-weight: bold;
            font-size: 1.5rem;
            color: #ffc107;
            text-shadow: 1px 1px 2px black;
            pointer-events: none;
        }
        @keyframes floatUp {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-50px);
            }
        }
    </style>
</head>
<body class="bg-pink-100 flex flex-col items-center justify-center min-h-screen p-4 overflow-hidden">

    <div id="game-container" class="relative w-full max-w-lg mx-auto">
        <!-- Game UI -->
        <div class="absolute top-0 left-0 right-0 p-4 z-10 flex justify-between items-center text-gray-800">
            <div class="bg-white/70 backdrop-blur-sm rounded-xl p-2 px-4 shadow-lg">
                <span class="text-lg font-semibold">Score:</span>
                <span id="score" class="text-xl font-bold">0</span>
            </div>
            <div class="bg-white/70 backdrop-blur-sm rounded-xl p-2 px-4 shadow-lg">
                <span class="text-lg font-semibold">Time:</span>
                <span id="timer" class="text-xl font-bold">60</span>
            </div>
        </div>
        
        <!-- Game Canvas -->
        <canvas id="gameCanvas" class="rounded-3xl shadow-2xl bg-white"></canvas>

        <!-- Floating Score Text Container -->
        <div id="floating-text-container" class="absolute inset-0"></div>
    </div>
    
    <!-- High Score Display -->
    <div class="mt-4 bg-white/70 backdrop-blur-sm rounded-xl p-2 px-6 shadow-lg text-center">
        <span class="text-lg font-semibold text-gray-800">High Score:</span>
        <span id="high-score" class="text-xl font-bold text-pink-500">0</span>
    </div>

    <!-- Modal Dialog -->
    <div id="modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center z-20">
        <div class="bg-white rounded-2xl p-8 shadow-2xl text-center max-w-sm mx-auto transform transition-all scale-95 opacity-0">
            <h2 id="modal-title" class="text-3xl font-bold text-gray-800 mb-2">Welcome to Sugar Smooth!</h2>
            <p id="modal-text" class="text-gray-600 mb-6">Click and drag the sugar wax over a hair patch, then quickly release to "rip" it out! Faster rips get more points. Clear the leg before time runs out!</p>
            <button id="start-button" class="bg-pink-500 text-white font-bold py-3 px-8 rounded-full hover:bg-pink-600 transform hover:scale-105 transition-transform shadow-lg">Start Game</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const timerEl = document.getElementById('timer');
        const highScoreEl = document.getElementById('high-score');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const startButton = document.getElementById('start-button');
        const floatingTextContainer = document.getElementById('floating-text-container');

        let score = 0;
        let timer = 60;
        let highScore = localStorage.getItem('sugarSmoothHighScore') || 0;
        let gameInterval;
        let isGameRunning = false;

        let hairs = [];
        let mousePos = { x: -100, y: -100 }; // Start cursor off-screen
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let selectedHair = null;

        const legColor = '#fde4cf'; // A light skin tone
        const legOutlineColor = '#e5cbad';

        // --- Game Setup ---

        function resizeCanvas() {
            const container = document.getElementById('game-container');
            const size = Math.min(container.clientWidth, window.innerHeight * 0.7);
            canvas.width = size;
            canvas.height = size;
            floatingTextContainer.style.width = `${size}px`;
            floatingTextContainer.style.height = `${size}px`;
            draw();
        }

        // The leg shape is defined by a series of points
        function getLegPath(width, height) {
            const path = new Path2D();
            // Start top-right of the calf
            path.moveTo(width * 0.75, height * 0.1);
            // Curve down the right side (calf muscle)
            path.bezierCurveTo(width * 0.95, height * 0.4, width * 0.8, height * 0.7, width * 0.65, height * 0.95);
            // Ankle curve at the bottom
            path.bezierCurveTo(width * 0.6, height * 1.0, width * 0.4, height * 1.0, width * 0.35, height * 0.95);
            // Up the left side (shin) - straighter
            path.bezierCurveTo(width * 0.2, height * 0.7, width * 0.25, height * 0.3, width * 0.45, height * 0.1);
            // Curve back to the start point (top of the leg)
            path.bezierCurveTo(width * 0.55, height * 0.0, width * 0.65, height * 0.0, width * 0.75, height * 0.1);
            path.closePath();
            return path;
        }
        
        // Check if a point is inside the leg shape
        function isPointInLeg(x, y) {
            const legPath = getLegPath(canvas.width, canvas.height);
            return ctx.isPointInPath(legPath, x, y);
        }

        function generateHairs(count) {
            hairs = [];
            let attempts = 0;
            while (hairs.length < count && attempts < count * 10) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const angle = Math.random() * Math.PI * 2;
                const length = 15 + Math.random() * 10;
                const size = 15; // hitbox size

                // Ensure hair is inside the leg and not too close to the edge
                if (isPointInLeg(x, y) && isPointInLeg(x + size, y) && isPointInLeg(x, y + size)) {
                     // Check for overlap with existing hairs
                    let overlaps = false;
                    for (const hair of hairs) {
                        const dx = hair.x - x;
                        const dy = hair.y - y;
                        if (Math.sqrt(dx * dx + dy * dy) < size * 2) {
                            overlaps = true;
                            break;
                        }
                    }

                    if (!overlaps) {
                        hairs.push({ x, y, angle, length, removed: false, size });
                    }
                }
                attempts++;
            }
        }
        
        function drawLeg() {
            ctx.save();
            const legPath = getLegPath(canvas.width, canvas.height);
            ctx.fillStyle = legColor;
            ctx.strokeStyle = legOutlineColor;
            ctx.lineWidth = 6;
            ctx.fill(legPath);
            ctx.stroke(legPath);
            ctx.clip(legPath); // Clip hairs to be drawn only inside the leg
        }

        function drawHairs() {
            hairs.forEach(hair => {
                if (!hair.removed) {
                    ctx.beginPath();
                    ctx.moveTo(hair.x, hair.y);
                    const endX = hair.x + Math.cos(hair.angle) * hair.length;
                    const endY = hair.y + Math.sin(hair.angle) * hair.length;
                    ctx.lineTo(endX, endY);
                    
                    // Second strand
                    ctx.moveTo(hair.x + 3, hair.y - 2);
                     const endX2 = hair.x + 3 + Math.cos(hair.angle - 0.2) * (hair.length - 2);
                    const endY2 = hair.y - 2 + Math.sin(hair.angle - 0.2) * (hair.length - 2);
                    ctx.lineTo(endX2, endY2);
                    
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            });
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawLeg();
            drawHairs();
            ctx.restore(); // Restore context after clipping
            
            // Draw custom cursor on top of everything
            drawCursor();
        }
        
        function drawCursor() {
            ctx.save();
            // Outer glow
            ctx.beginPath();
            ctx.arc(mousePos.x, mousePos.y, 22, 0, Math.PI * 2);
            ctx.fillStyle = isDragging ? 'rgba(255, 200, 100, 0.5)' : 'rgba(255, 223, 186, 0.4)';
            ctx.fill();

            const gradient = ctx.createRadialGradient(mousePos.x, mousePos.y, 5, mousePos.x, mousePos.y, 20);
            if (isDragging) {
                gradient.addColorStop(0, '#d4af37'); // Gold
                gradient.addColorStop(1, '#b8860b'); // Darker Gold
            } else {
                gradient.addColorStop(0, '#f8d568'); // Lighter Gold
                gradient.addColorStop(1, '#d4af37'); // Gold
            }

            ctx.beginPath();
            ctx.arc(mousePos.x, mousePos.y, 20, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // Highlight
            ctx.beginPath();
            ctx.arc(mousePos.x - 5, mousePos.y - 5, 8, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.fill();

            ctx.restore();
        }

        // --- Game Logic ---
        
        function update() {
            if (!isGameRunning) return;
            // Game logic that needs continuous updates can go here
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        function startTimer() {
            timer = 60;
            timerEl.textContent = timer;
            gameInterval = setInterval(() => {
                timer--;
                timerEl.textContent = timer;
                if (timer <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function startGame() {
            score = 0;
            scoreEl.textContent = score;
            isGameRunning = true;
            generateHairs(25);
            hideModal();
            startTimer();
        }

        function endGame() {
            isGameRunning = false;
            clearInterval(gameInterval);
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('sugarSmoothHighScore', highScore);
                highScoreEl.textContent = highScore;
                modalTitle.textContent = "New High Score!";
                modalText.innerHTML = `You smoothed the leg with a score of <strong class="text-pink-500 text-xl">${score}</strong>! Great job!`;
            } else {
                modalTitle.textContent = "Time's Up!";
                modalText.innerHTML = `You finished with a score of <strong class="text-pink-500 text-xl">${score}</strong>. Try to beat your high score of ${highScore}!`;
            }
            startButton.textContent = "Play Again";
            showModal();
        }
        
        function showFloatingText(text, x, y) {
            const p = document.createElement('p');
            p.textContent = text;
            p.className = 'floating-text';
            p.style.left = `${x}px`;
            p.style.top = `${y}px`;
            floatingTextContainer.appendChild(p);
            setTimeout(() => {
                floatingTextContainer.removeChild(p);
            }, 1000);
        }

        // --- Event Handlers ---

        function getMousePos(evt) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }
        
        function handleMouseDown(e) {
            if (!isGameRunning) return;
            const pos = getMousePos(e.type === 'touchstart' ? e.touches[0] : e);

            for (const hair of hairs) {
                if (!hair.removed) {
                    const dx = hair.x - pos.x;
                    const dy = hair.y - pos.y;
                    if (Math.sqrt(dx * dx + dy * dy) < hair.size) {
                        isDragging = true;
                        dragStart = { x: pos.x, y: pos.y, time: Date.now() };
                        selectedHair = hair;
                        break;
                    }
                }
            }
        }
        
        function handleMouseUp(e) {
            if (!isGameRunning || !isDragging || !selectedHair) return;

            const pos = getMousePos(e.type === 'touchend' ? e.changedTouches[0] : e);
            const dragEnd = { x: pos.x, y: pos.y, time: Date.now() };

            const distance = Math.sqrt(Math.pow(dragEnd.x - dragStart.x, 2) + Math.pow(dragEnd.y - dragStart.y, 2));
            const timeDiff = dragEnd.time - dragStart.time;
            const speed = distance / timeDiff; // pixels per millisecond

            if (distance > 20 && timeDiff < 500) { // A "rip" requires some distance and speed
                selectedHair.removed = true;
                
                let points = 50;
                let bonus = Math.floor(speed * 100);
                if (bonus > 150) bonus = 150; // Cap bonus
                points += bonus;
                
                score += points;
                scoreEl.textContent = score;

                showFloatingText(`+${points}`, selectedHair.x, selectedHair.y);
            }
            
            // Check if all hairs are removed
            if (hairs.every(h => h.removed)) {
                // Give a time bonus and respawn hairs
                timer += 10;
                timerEl.textContent = timer;
                score += 500; // Level clear bonus
                scoreEl.textContent = score;
                showFloatingText("LEVEL CLEAR! +500", canvas.width / 2, canvas.height / 2);
                generateHairs(25 + Math.floor(score / 1000)); // Increase difficulty
            }

            isDragging = false;
            selectedHair = null;
        }

        function handleMouseMove(e) {
            const pos = getMousePos(e.type === 'touchmove' ? e.touches[0] : e);
            mousePos.x = pos.x;
            mousePos.y = pos.y;
        }

        // --- Modal Control ---
        function showModal() {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function hideModal() {
            modal.querySelector('div').classList.add('scale-95', 'opacity-0');
            modal.classList.add('opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // --- Init ---
        function init() {
            highScoreEl.textContent = highScore;
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            startButton.addEventListener('click', startGame);

            canvas.addEventListener('mousedown', handleMouseDown);
            document.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mousemove', handleMouseMove);
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleMouseDown, { passive: true });
            document.addEventListener('touchend', handleMouseUp, { passive: true });
            canvas.addEventListener('touchmove', handleMouseMove, { passive: true });
            
            showModal(); // Show the initial welcome modal
            gameLoop();
        }

        init();
    </script>
</body>
</html>